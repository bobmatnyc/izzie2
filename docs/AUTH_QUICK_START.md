# Better Auth - Quick Start

## TL;DR

```bash
# 1. Configure environment variables
cp .env.example .env
# Edit .env with your Google OAuth credentials

# 2. Run setup script
./scripts/setup-auth.sh

# 3. Start development server
npm run dev

# 4. Test authentication
# Navigate to http://localhost:3300
# Click "Sign in with Google"
```

## Google OAuth Setup (5 minutes)

1. **Go to Google Cloud Console**
   - https://console.cloud.google.com/apis/credentials

2. **Create OAuth 2.0 Client**
   - Application type: Web application
   - Authorized redirect URIs:
     ```
     http://localhost:3300/api/auth/callback/google
     ```

3. **Copy credentials to `.env`**
   ```bash
   GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
   GOOGLE_CLIENT_SECRET=your-client-secret
   ```

4. **Enable Google Calendar API**
   - https://console.cloud.google.com/apis/library/calendar-json.googleapis.com
   - Click "Enable"

## Environment Variables

Required variables in `.env`:
```bash
# Google OAuth
GOOGLE_CLIENT_ID=...
GOOGLE_CLIENT_SECRET=...

# Better Auth (auto-generated by setup script)
BETTER_AUTH_SECRET=...

# Database (Neon Postgres)
DATABASE_URL=postgresql://...

# App URL
NEXT_PUBLIC_APP_URL=http://localhost:3300
```

## Usage

### Sign In with Google

```typescript
import { signInWithGoogle } from '@/lib/auth/client';

<button onClick={signInWithGoogle}>Sign in with Google</button>
```

### Get Current User

```typescript
import { useSession } from '@/lib/auth/client';

function MyComponent() {
  const { data: session, isPending } = useSession();

  if (isPending) return <div>Loading...</div>;
  if (!session) return <div>Not signed in</div>;

  return <div>Welcome, {session.user.name}!</div>;
}
```

### Protect API Routes

```typescript
import { requireAuth } from '@/lib/auth';

export async function GET(request: NextRequest) {
  const session = await requireAuth(request);
  // User is authenticated
  return NextResponse.json({ user: session.user });
}
```

## API Endpoints

- `GET /api/auth/sign-in/google` - Start Google OAuth
- `GET /api/auth/callback/google` - OAuth callback
- `POST /api/auth/sign-out` - Sign out
- `GET /api/auth/session` - Get current session
- `GET /api/protected/me` - Protected route example

## Testing

```bash
# Test sign-in flow
curl http://localhost:3300/api/auth/sign-in/google

# Test protected route (should return 401)
curl http://localhost:3300/api/protected/me

# After signing in via browser:
curl http://localhost:3300/api/protected/me -b cookies.txt
```

## Next Steps

- ‚úÖ Authentication working
- ‚è≠Ô∏è Implement Calendar API integration (ticket #21)
- üìö Read [full documentation](./AUTH_SETUP.md)

## Troubleshooting

**"Redirect URI mismatch"**
- Check Google Console has `http://localhost:3300/api/auth/callback/google`

**"Invalid client"**
- Verify `GOOGLE_CLIENT_ID` and `GOOGLE_CLIENT_SECRET` in `.env`

**"Session not found"**
- Ensure `BETTER_AUTH_SECRET` is set (run setup script)

**More help**: See [AUTH_SETUP.md](./AUTH_SETUP.md)
